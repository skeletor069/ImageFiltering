function [Gx, Gy, gray] = Test(img)sigma = .5;radius = ceil(3 * sigma);kernel_size = (radius * 2) + 1;cx = zeros(kernel_size);cx(:,1) = -2;cx(:,2) = -1;cx(:,4) = 1;cx(:,5) = 2;cy = transpose(cx);k = -1/(2 * 3.14* sigma*sigma*sigma*sigma);Gx = k .* exp(-(cx.^2 + cy.^2)/(2*sigma*sigma));Gx = cx .* Gx;Gy = transpose(Gx);gray = rgb2gray(img);%level = graythresh(gray);%gray = im2bw(gray,level);%gray = imcomplement(gray);gray = im2double(gray);[R,C] = size(gray)I_x = zeros(R-radius, C-radius);I_y = zeros(R-radius, C-radius);for r = (radius + 1):(R-kernel_size)for c = (radius + 1):(C-kernel_size)  source = gray(r:r+kernel_size-1,c:c+kernel_size-1);  %disp('-----------------');  source_x = source .* Gx;  source_y = source .* Gy;    sum_x = sum(sum(source_x));  sum_y = sum(sum(source_y));    I_x(r,c) = sum_x;  I_y(r,c) = sum_y;endendfigure;imshow(I_x);figure;imshow(I_y);end